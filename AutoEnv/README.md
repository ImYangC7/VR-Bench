# AutoEnv - AI Game Skin Generator

**Part of VR-Bench Project**

Generate themed 2D game skins for maze-type games using AI image generation with automatic visual description.

## âœ¨ Features

- ğŸ® **4 Game Types**: maze, pathfinder, sokoban, trapfield
- ğŸ¨ **Custom Themes**: Any visual style you can describe
- ğŸ¤– **AI Visual Description**: Automatic skin description using vision models
- âš¡ **Async Pipeline**: Parallel asset generation with DAG architecture
- ğŸ¯ **Style Consistency**: Style Anchor mechanism ensures unified look
- ğŸ’° **Cost Tracking**: Real-time API usage and cost monitoring
- ğŸ–¼ï¸ **Auto Processing**: Background removal and transparent PNG output

## ğŸš€ Quick Start

### 1. Install Dependencies

All dependencies are managed in VR-Bench's root `requirements.txt`:

```bash
cd /data/yc/VR-Bench
pip install -r requirements.txt
```

### 2. Configure API

Edit `/data/yc/VR-Bench/.env` file:

```bash
# Image Generation API (for AutoEnv skin generation)
IMAGE_GEN_API_KEY=your_api_key_here
IMAGE_GEN_BASE_URL=https://api.openai.com/v1
IMAGE_GEN_MODEL=gemini-2.5-flash-image
```

> ğŸ’¡ **Note**: AutoEnv uses VR-Bench's unified `.env` configuration. Environment variables are automatically loaded.

### 3. Generate Skins

```bash
cd /data/yc/VR-Bench/AutoEnv
python run_skin_generation.py \
  --maze-type maze \
  --theme "cyberpunk neon city"
```

## ğŸ® Game Types

| Type | Components | Description |
|------|------------|-------------|
| `maze` | 4 | player, goal, wall, floor |
| `pathfinder` | 3 | start, end, road |
| `sokoban` | 5 | player, goal, box, wall, floor |
| `trapfield` | 4 | player, goal, trap, floor |

## ğŸ“¦ Output Structure

```
workspace/envs/<game_type>_<timestamp>/
â”œâ”€â”€ analysis.json          # Game configuration analysis
â”œâ”€â”€ strategy.json          # Asset generation strategy
â””â”€â”€ skins/                 # Generated skin assets
    â”œâ”€â”€ wall.png          # Transparent PNG (auto-cropped)
    â”œâ”€â”€ floor.png
    â”œâ”€â”€ player.png
    â”œâ”€â”€ target.png
    â””â”€â”€ description.json  # AI-generated visual descriptions
```

### description.json Example

```json
{
  "game_type": "maze",
  "skin_id": "20231214_130944",
  "visual_description": {
    "player": "white rabbit",
    "goal": "orange carrots",
    "wall": "gray rock",
    "floor": "green grass tiles"
  }
}
```

> ğŸ¤– **AI-Powered**: Visual descriptions are automatically generated by analyzing the actual skin images using vision models.

## ğŸ’¡ Examples

```bash
# Medieval castle maze
python run_skin_generation.py --maze-type maze --theme "medieval stone castle"

# Candy land pathfinder
python run_skin_generation.py --maze-type pathfinder --theme "candy land with lollipops"

# Industrial warehouse sokoban
python run_skin_generation.py --maze-type sokoban --theme "industrial warehouse"

# Lava dungeon trapfield
python run_skin_generation.py --maze-type trapfield --theme "lava dungeon with fire"
```

ğŸ’¡ See `config/maze_examples.yaml` for 20+ theme ideas.

## ğŸ—ï¸ Architecture

### Pipeline (DAG)

```
Analyzer â†’ Strategist â†’ AssetGenerator â†’ BackgroundRemoval
```

| Node | Function | Output |
|------|----------|--------|
| **AnalyzerNode** | Load game configuration | `analysis.json` |
| **StrategistNode** | Generate asset prompts | `strategy.json` |
| **AssetGeneratorNode** | Create images (Style Anchor + I2I) | PNG files |
| **BackgroundRemovalNode** | Process & analyze images | Transparent PNGs + `description.json` |

### Key Mechanisms

1. **Style Anchor**: First asset (wall/road) generated via text-to-image, others use image-to-image for consistency
2. **Parallel Generation**: All non-anchor assets generated concurrently using `asyncio.gather()`
3. **Vision Analysis**: Each skin analyzed by multimodal LLM to generate visual descriptions
4. **Cost Tracking**: Real-time monitoring using `contextvars` for thread-safe cost aggregation

### Project Structure

```
AutoEnv/
â”œâ”€â”€ run_skin_generation.py          # Entry point (164 lines)
â”œâ”€â”€ base/
â”‚   â”œâ”€â”€ engine/
â”‚   â”‚   â”œâ”€â”€ async_llm.py           # LLM client (449 lines)
â”‚   â”‚   â””â”€â”€ cost_monitor.py        # Cost tracking (116 lines)
â”‚   â”œâ”€â”€ pipeline/
â”‚   â”‚   â”œâ”€â”€ base_node.py           # Node abstraction (45 lines)
â”‚   â”‚   â””â”€â”€ base_pipeline.py       # DAG executor (55 lines)
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ image.py               # Image utilities (13 lines)
â”œâ”€â”€ autoenv/
â”‚   â””â”€â”€ pipeline/
â”‚       â””â”€â”€ visual/
â”‚           â”œâ”€â”€ nodes.py           # 4 pipeline nodes (365 lines)
â”‚           â”œâ”€â”€ pipeline.py        # Visual pipeline (80 lines)
â”‚           â”œâ”€â”€ prompt.py          # Prompt templates (12 lines)
â”‚           â””â”€â”€ maze_assets_config.py  # Asset configs (200 lines)
â””â”€â”€ config/
    â”œâ”€â”€ env_skin_gen.yaml          # Default config
    â””â”€â”€ maze_examples.yaml         # 20+ theme examples

Total: ~1650 lines of clean, focused code
```

## âš™ï¸ Configuration

### Environment Variables

AutoEnv integrates with VR-Bench's unified `.env` configuration:

```bash
# Image Generation API (for skin generation)
IMAGE_GEN_API_KEY=your_api_key_here
IMAGE_GEN_BASE_URL=https://api.openai.com/v1
IMAGE_GEN_MODEL=gemini-2.5-flash-image
```

### Configuration Priority

1. **Environment Variables** (highest) - from `VR-Bench/.env`
2. **YAML Config** (fallback) - from `config/model_config.yaml`

### Supported Models

- `gemini-2.5-flash-image` (recommended, fast & cheap)
- `dall-e-3` (high quality)
- Any OpenAI-compatible image generation API

## ğŸ“‹ Requirements

- Python 3.10+
- Dependencies: `openai`, `pydantic`, `rembg`, `pillow`, `python-dotenv`
- Image generation API with vision capability
- All dependencies managed in VR-Bench's root `requirements.txt`

## ğŸ”— Integration with VR-Bench

AutoEnv is part of the VR-Bench project:

- âœ… **Unified Configuration**: Shares `.env` file with VR-Bench
- âœ… **Dependency Management**: Single `requirements.txt` at VR-Bench root
- âœ… **Output Format**: Compatible with VR-Bench's skin format
- âœ… **Cost Tracking**: Integrated cost monitoring system
- âœ… **Secure**: Credentials not in version control

## ğŸ“Š Code Statistics

- **Total Lines**: 1,648
- **Python Files**: 16
- **Core Nodes**: 4 (Analyzer, Strategist, Generator, BackgroundRemoval)
- **Architecture**: Clean DAG pipeline with Pydantic validation

## ğŸ“„ License

MIT License

